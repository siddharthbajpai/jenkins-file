pipeline {
    agent any

    parameters {
        string(name: 'TF_VAR_region', defaultValue: 'us-west-2', description: 'AWS region')
        string(name: 'TF_VAR_instance_type', defaultValue: 't2.micro', description: 'EC2 instance type')
        string(name: 'ECR_REPOSITORY_NAME', defaultValue: 'my-repo', description: 'ECR Repository Name')
        // Add more parameters as needed
    }

    stages {
        stage('Checkout') {
            steps {
                checkout scm
            }
        }

        stage('Generate TFVars') {
            steps {
                script {
                    // Generate terraform.tfvars file with parameters
                    writeFile file: 'terraform.tfvars', text: """\
region = "${params.TF_VAR_region}"
instance_type = "${params.TF_VAR_instance_type}"
ecr_repository_name = "${params.ECR_REPOSITORY_NAME}"
"""
                }
            }
        }

        stage('Terraform Init') {
            steps {
                script {
                    // Initialize Terraform
                    sh 'terraform init'
                }
            }
        }

        stage('Terraform Plan') {
            steps {
                script {
                    // Generate Terraform plan
                    sh 'terraform plan'
                }
            }
        }

        stage('Terraform Apply') {
            steps {
                script {
                    // Apply Terraform configuration
                    sh 'terraform apply -auto-approve'
                }
            }
        }
    }
}
